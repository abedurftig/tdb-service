task uploadTestResults(type: Exec) {

    def name = rootProject.getName()
    def suffix = getTestRunSlug()
    workingDir './upload'
    executable 'sh'

    args "-c", "source ./upload.sh -p $name -t $suffix"

    //store the output instead of printing to the console:
    standardOutput = new ByteArrayOutputStream()
    ext.output = {
        return standardOutput.toString()
    }

}

test.finalizedBy uploadTestResults

def getTestRunSlug() {
    return System.getenv("CI_COMMIT_REF_NAME") + "@" + System.getenv("CI_PIPELINE_ID")
}
